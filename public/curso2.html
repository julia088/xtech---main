<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="barra.css">
    <link rel="stylesheet" href="cursos.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
    <link rel="stylesheet" href="estrela.css">
    <script src="barra.js"></script>
    <title>Curso de Empreendedorismo</title>
</head>

<body data-curso-id="2">
    <header>
        <nav class="container">
            <button class="card-seta material-symbols-outlined" onclick="backToPage()">arrow_back</button>
        </nav>
    </header>

    <div class="titulocurso"><h2>CAPS - Centro de Assistência a Programadores de Sistemas</h2></div>
    <center>
    <div class="backcont">
        <br><br>
        <h1>
            
            EMPREENDEDORISMO
            
        </h1>
        <br>
        <br><br><br>
        <div class="button-group"> 
            <button onclick="emp1()">Aula 1</button>
            <button onclick="emp2()">Aula 2</button>
            <button onclick="emp3()">Aula 3</button>
            <button onclick="completeExercises()">Exercícios</button>
        </div>

        <br><br>

        <div class="video-container">
            <div class="click-overlay" onclick="advanceProgress(this)"></div>
        </div>
        <br><br>
        <div class="bar">
            <div class="progress">0%</div> 
        </div>
        <br><br>
    </div>
    </center>

    <div class="container swiper" id="exercise-container" style="display: none;">
        <br><br>
        <div class="questionnaire">
            <h3>Responda as perguntas a seguir:</h3>
            <form id="quiz-form">
                <div class="question">
                    <label>1. Segundo os vídeos, qual é a característica mais importante para um empreendedor iniciante?</label><br>
                    <input type="radio" name="q1" value="capital" required> Ter muito capital inicial para investir<br>
                    <input type="radio" name="q1" value="correta"> Ter capacidade de adaptação e resiliência<br>
                    <input type="radio" name="q1" value="contatos"> Possuir uma grande rede de contatos influentes<br>
                </div>
                <br>
                <div class="question">
                    <label>2. O que os vídeos sugerem como melhor abordagem para validar uma ideia de negócio?</label><br>
                    <input type="radio" name="q2" value="correta" required> Criar um MVP (Produto Mínimo Viável) e testar com um público pequeno<br>
                    <input type="radio" name="q2" value="pesquisa"> Fazer apenas pesquisas de mercado teóricas<br>
                    <input type="radio" name="q2" value="investimento"> Esperar por um grande investimento antes de começar<br>
                </div>
                <br>
                <div class="question">
                    <label>3. Qual conselho é comum nos vídeos sobre como lidar com o fracasso nos negócios?</label><br>
                    <input type="radio" name="q3" value="esconder" required> Esconder os erros para manter a imagem<br>
                    <input type="radio" name="q3" value="correta"> Aprender com os erros e usá-los como oportunidade para melhorar<br>
                    <input type="radio" name="q3" value="desistir"> Desistir rapidamente se algo der errado na primeira tentativa<br>
                </div>
                <br>
                <div class="question">
                    <label>4. Segundo os vídeos, qual é o fator crucial para inovar em um negócio?</label><br>
                    <input type="radio" name="q4" value="tecnologia" required> Ter a tecnologia mais avançada disponível<br>
                    <input type="radio" name="q4" value="correta"> Resolver problemas reais das pessoas de forma simples<br>
                    <input type="radio" name="q4" value="copiar"> Copiar modelos de negócios bem-sucedidos sem adaptação<br>
                </div>
                <br>
                <div class="question">
                    <label>5. O que os vídeos recomendam sobre o momento ideal para começar um negócio?</label><br>
                    <input type="radio" name="q5" value="esperar" required> Esperar até ter todas as condições perfeitas<br>
                    <input type="radio" name="q5" value="correta"> Começar pequeno agora e ir ajustando com o tempo<br>
                    <input type="radio" name="q5" value="concorrentes"> Esperar até que os concorrentes saiam do mercado<br>
                </div>
                <br>
                <button type="submit">Enviar Respostas</button>
            </form>
        </div>

        <div id="popup" class="popup hidden">
            <div class="popup-content">
                <span class="close-btn" onclick="closePopup()">&times;</span>
                <h2>Obrigado por enviar suas respostas!</h2>
                <h2>Gostaria de avaliar nosso curso?</h2>
                <div class="rating">
                    <input type="radio" id="star1" name="rating" value="1" onclick="rateCourse(5)"><label for="star1"></label>
                    <input type="radio" id="star2" name="rating" value="2" onclick="rateCourse(4)"><label for="star2"></label>
                    <input type="radio" id="star3" name="rating" value="3" onclick="rateCourse(3)"><label for="star3"></label>
                    <input type="radio" id="star4" name="rating" value="4" onclick="rateCourse(2)"><label for="star4"></label>
                    <input type="radio" id="star5" name="rating" value="5" onclick="rateCourse(1)"><label for="star5"></label>
                </div>                             
            </div>
        </div>

    </div>

    <script>
       // Captura o id do curso do atributo data-curso-id
    const cursoId = document.body.getAttribute('data-curso-id');

// Função para enviar o ID do curso ao backend (exemplo usando fetch)
function enviarCursoId() {
fetch('/api/curso/' + cursoId)
    .then(response => response.json())
    .then(data => {
        console.log('Dados do curso:', data);
        // Aqui você pode manipular os dados recebidos
    })
    .catch(error => {
        console.error('Erro:', error);
    });
    }
    // Chame a função quando necessário, por exemplo, ao carregar a página
    window.onload = enviarCursoId;


    let progress = 0;
    const lessonsCompleted = {
        lesson1: false,
        lesson2: false,
        lesson3: false,
        exercises: false,
    };

    // Função para calcular e enviar o progresso atualizado ao backend
    function updateAndSaveProgress() {
    const cursoId = document.body.getAttribute('data-curso-id');
    
    // Limitar o progresso a 100%
    if (progress > 100) {
        progress = 100;
    }

    // Atualizar a barra de progresso
    const progressBar = document.querySelector('.progress');
    progressBar.style.width = progress + '%';
    progressBar.textContent = progress + '%';

    // Enviar o progresso atualizado para o backend
    salvarProgresso(cursoId, progress);
    }

        function emp1() {
            const videoContainer = document.querySelector('.video-container');
            advanceProgress('lesson1');
            videoContainer.innerHTML = `
                <div class="click-overlay" onclick="advanceProgress('lesson1')"></div>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/swe0zFQKrO4?si=BivvC5_Dld8HAkat" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            `;
        }

        function emp2() {
            const videoContainer = document.querySelector('.video-container');
            advanceProgress('lesson2');
            videoContainer.innerHTML = `
                <div class="click-overlay" onclick="advanceProgress('lesson2')"></div>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/Sec2bizoSxY?si=3kBgiDA4iuUvRPIh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            `;
        }

        function emp3() {
            const videoContainer = document.querySelector('.video-container');
            advanceProgress('lesson3');
            videoContainer.innerHTML = `
                <div class="click-overlay" onclick="advanceProgress('lesson3')"></div>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/hyL31LVgXUk?si=iwAcpkkqJAf7M3ga" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            `;
        }

        function completeExercises() {
            const videoContainer = document.querySelector('.video-container');
            document.getElementById('exercise-container').style.display = 'block';
        }

        document.getElementById('quiz-form').addEventListener('submit', function(event) {
            event.preventDefault();
            verificarRespostas();
        });

        function verificarRespostas() {
        let acertos = 0;
        let totalQuestoes = Object.keys(respostasCorretas).length;


        for (let pergunta in respostasCorretas) {
            const respostaSelecionada = document.querySelector(`input[name="${pergunta}"]:checked`);
            if (respostaSelecionada && respostaSelecionada.value === respostasCorretas[pergunta]) {
                acertos++;
            }
        }

        const erros = totalQuestoes - acertos;

        // Atualizar progresso com base nos acertos
        if (acertos > 0) {
            progress += acertos * 5; // Avança 5% para cada resposta correta
            updateAndSaveProgress(); 
            if (progress > 100) {
                progress = 100; // Limita o progresso a 100%
            }
            const progressBar = document.querySelector('.progress');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }

        alert(`Você acertou ${acertos} de ${totalQuestoes} perguntas e errou ${erros}.`);
        openPopup(); // Abre o popup após verificar as respostas
    }

        function advanceProgress(lesson) {
            if (!lessonsCompleted[lesson]) {
                progress += 25;
                lessonsCompleted[lesson] = true;
                updateAndSaveProgress(); 
                const progressBar = document.querySelector('.progress');
                if (progress > 100) {
                    progress = 100;
                }
                progressBar.textContent = progress + '%';
                progressBar.style.width = progress + '%';

            }
        }

        const respostasCorretas = {
            q1: "correta",
            q2: "correta",
            q3: "correta",
            q4: "correta",
            q5: "correta"
        };


        function openPopup() {
            document.getElementById("popup").classList.remove("hidden");
        }
   
        function closePopup() {
            document.getElementById("popup").classList.add("hidden");
        }
   
        window.onclick = function(event) {
            var popup = document.getElementById('popup');
            if (event.target === popup) {
                closePopup();
            }
        }
   
        document.getElementById("quiz-form").addEventListener("submit", function(event) {
            event.preventDefault();
            openPopup();
        });
       
        function rateCourse(rating) {
    const ratingInputs = document.querySelectorAll('input[name="rating"]');
    ratingInputs.forEach(input => input.disabled = true);

    // Extraindo o cursoId do body
    const cursoId = document.body.getAttribute('data-curso-id');

    // Validando o rating
    if (rating < 1 || rating > 5) {
        alert('Rating deve estar entre 1 e 5.');
        return;
    }

    console.log('Enviando avaliação:', { curso_id: cursoId, rating });

    // Enviar a avaliação para o backend
    fetch('/avaliacao', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ curso_id: cursoId, rating })
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => {
                console.error('Erro ao salvar a avaliação:', err.message);
                alert(`Erro: ${err.message}`); // Alerta ao usuário
                throw new Error(err.message);
            });
        }
        return response.json();
    })
    .then(data => {
        console.log(data);
        // Redirecionar para portalAluno.html após salvar a avaliação
        window.location.href = "portalAluno.html";
    })
    .catch(error => {
        console.error('Erro ao salvar a avaliação:', error);
        alert('Houve um erro ao salvar sua avaliação. Tente novamente.');
    });
}


function salvarProgresso(cursoId, progresso) {

    const usuarioId = sessionStorage.getItem('usuarioId');
    fetch('/salvarProgresso', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ usuario_id: usuarioId, curso_id: cursoId, progresso: progresso }),
    })
    .then(response => response.json())
    .then(data => {
        console.log(data.message);
        // Redirecionar ou fazer outras ações
    })
    .catch((error) => {
        console.error('Erro ao salvar progresso:', error);
    });
}
    </script>
    
</body>
</html>